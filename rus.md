# Магические числа в CSS

Несмотря на довольно весёлое название, магические числа - это плохо. Термин 
[берёт свое начало в программировании][1] и позначает «безымянную числовую 
константу». Другими словами, это помещенное в код число, которое сильно влияет 
на то будет ли код работать корректно, но его конкретное предназначение 
непонятно тем, кто не слишком тщательно разобрался в коде. В CSS очень часто 
встречаются безымянные числовые константы, но они обычно окружены контекстом в 
виде селекторов и свойств, потому не являются слишком загадочными. И все же, в 
CSS присутствуют магические числа и ничего хорошего в этом нет. 

В CSS магическими можно назвать числа, которые «работают» в определённых 
обстоятельствах, но очень хрупки и склонны к сбоям когда эти обстоятельства 
изменяются. **В большинстве случаев они имеют какое-то отношение к шрифтам**. Их 
обычно используют люди, которые ограничиваются тестированием в одном браузере с 
идеальными настройками. Давайте рассмотрим несколько примеров чтобы разобраться 
что такое магические числа и избегать в будущем. 

Взгляните на этот простой набор вкладок:

![Вкладки1][Простой набор вкладок]

Для каждой из вкладок установлена ширина `width: 100px;`. В этом примере `100px` 
и есть тем самым «магическим числом". При его использовании много что может 
работать не так как нужно. В этом можно убедиться, добавив вкладку с текстом 
подлиннее: 

![Вкладки2][Добавление вкладки с более длинным названием демонстрирует недостатки фиксированной ширины]

Выглядит немного странно и вряд ли так, как хотелось бы. Переноса строки можно 
избежать применив `white-space: nowrap;`, но так наверное еще хуже:

![Вкладки3][Эффект от white-space: nowrap]

Вероятность некрасивого отображении вкладок можно уменьшить используя min-width:

![Вкладки4][Вид вкладок с заданной минимальной шириной]

Или же можно вообще не указывать ширину:

![Вкладки5][Вид вкладок без фиксированной ширины]

Если же вы во что бы то ни стало хотите чтобы все вкладки были одной ширины, 
можете попробовать использовать `overflow: hidden;` и `text-overflow: ellipsis;`:

![Вкладки6][Эффект от overflow: hidden; и text-overflow: ellipsis;]

В таком случае наверное стоит добавить атрибут `title`, чтобы можно было 
каким-то образом отобразить полное название вкладки. Вам может прийти в голову 
что это можно решить путем ограничения длины названий вкладок в системе 
управления контентом. Но как насчет пользователей, которые самостоятельно 
увеличивают размер шрифта для своего удобства? Такое решение с ограничением 
длины названия вкладок может причинить им неудобства. 

В недавней публикации [«Заголовки с линиями по бокам»][2] я использовал для 
свойства line-height значение, которое можно считать магическим числом. Скажем, 
вы использовали этот прием в сочетании с причудливым шрифтом, подключенным через 
@font-face. Теперь представьте что подключенный шрифт не загрузился, или же 
пользователь поменял его на какой-то другой, или страницу просматривают в 
браузере, который не поддерживает @font-face. Загружается запасной шрифт, 
размеры которого могут кардинально отличаться от размеров вашего подключенного 
шрифта. Линии вокруг текста с запасным шрифтом размещаются странным образом и не 
центрируются как было задумано. Магическое число не работает. 

![Шрифты][Сравнение результата применения приёма по добавлению линий по бокам текста примененного к разным шрифтам]

Этот конкретный пример немного надуман, но, могу поспорить, вы встречали 
подключенные шрифты с немыслимой высотой строчного знака и т.п. 

Скажем у вас есть группа блоков с различным количеством содержимого. Вам нужно 
расположить их в виде сетки, потому вы делаете их плавающими по левому краю. 
Получается довольно безобразно:

![Блоки1][Блоки с разной высотой, плавающие по левому краю]

Постойте, ведь если задать для них одинаковую высоту, проблема будет решена!

![Блоки2][Блоки с фиксированной высотой, плавающие по левому краю]

Это если пользователь будет просматривать сайт с точно такими же настройками 
размеров шрифта, что и у вас. Но пользователи могут их менять.

![Chrome][Настройки шрифта в Chrome]

В этом месте можно даже пустить слезу:

![Блоки3][Текст, который не помещается в родительский блок с фиксированной высотой, перекрывает другие блоки]

Используя [min-height][4] можно избежать странностей с перекрытием, но тогда 
размеры блоков будут разными и снова возникает проблема с `float`. Я не буду 
слишком углубляться в решение этой ситуации, потому что она и без того стала 
слишком абстрактной, но наверняка можно использовать прокрутку внутри блоков, 
подкорректировать размеры блоков с помощью JavaScript или же использовать 
какой-то другой макет. 

Гарри Робертс (Harry Roberts) привел классический пример магического числа в 
своей статье [«Код CSS "с душком"»][5]. 

    .site-nav > li:hover .dropdown{
      position: absolute;
      top: 37px;
      left: 0;
    }

Это код для выпадающего меню на CSS. Меню спрятано за пределами экрана до тех 
пор пока пользователь не наведет курсор на элемент в родительском списке, тогда 
выпадающее меню появляется в зоне видимости. Оно должно располагаться под 
родительским элементом меню. В браузере автора этого кода высота родительского 
элемента составляла 37px. Уверен, вы уже успели предположить что это не во всех 
случаях будет так. 37px является магическим числом. Гарри советует заменить его 
на `top: 100%`, сбои при котором намного менее вероятны. 

В статье [«Боремся с пробелами между элементами со свойством Inline-Block»][6], 
автор утверждает что задав значение -4px для границ, можно избавиться от лишнего 
пространства между блоками. Это без сомнения магическое число. По стечению 
обстоятельств, 4px - это всего лишь ширина пробела для довольно большого 
количества гарнитур при кегле 16px, который обычно указан по умолчанию.

Измените `font-family` на что-то вроде Monaco. Сбой. Увеличьте или уменьшите 
кегль. Сбой. 

![Сбой][Приём по применению границы в -4px чтобы убрать отступы между элементами со свойством Inline-Block перестаёт работать когда меняется гарнитура или кегль]

В [этой статье][7] указаны и другие возможные решения. 

## Путаница в определении

Так как я пытаюсь аргументировать отказ от использования магических чисел, нужно 
четко определить что же они из себя представляют когда речь идет о CSS. Я стал 
свидетелем множества обсуждений в которых мнения на этот счёт расходятся. 
[(1)][8] [(2)][9] [(3)][10]. 

Вот несколько примеров:

**CSS**

    -webkit-transform: translateZ(0);

Магическое число? Нет. Просто маленький хак, который мы когда-то использовали 
чтобы улучшить производительность.

**CSS**

    .parent {
      padding: 22px;
    }
    .child {
      bottom: 22px;
      left: 22px;
    }

Магическое число? Нет. Это число странное, но не магическое. Дочерний элемент 
позиционируется по нижнему левому краю родительского элемента без отступов. 
Поскольку числа одинаковы, происходящее вполне логично. Если бы все они были 
разными, это бы значило что здесь не обошлось без хитромудрой привязки к 
`font-size` и тогда речь бы шла о магических числах. 

**CSS**

    top: 37px;

Допустим что это магическое число, так же как и в примере с выпадающим меню выше. 
Можно ли с этим разобраться с помощью Sass?

**SCSS**

    $topDistance: 37px;

    .dropdown {
      top: $topDistance;
    }

Это больше не «безымянная» числовая константа, так как мы дали ей название, 
верно? Тем не менее это все еще магическое число в CSS. Оно осталось столь же 
хрупким как и было. 

**CSS**

    letter-spacing: -.05em;

Магическое число? Нет. Оно наверное было бы таким если бы использовались 
пиксели, так как значение в пикселях остается неизменным и эффект от его 
использования зависит от текущего значения font-size. При большом font-size 
изменения практически незаметны, при маленьком font-size, изменения существенны. 
Использование относительных единиц уменьшает вероятность сбоев. 

## В качестве заключения

Знали бы вы как я не люблю эту часть публикаций, однако полезно выделить своего 
рода свалку для мелочей, которым не нашлось место где-нибудь еще. 

* [Согласно][11] CSS стандартам, предложенным командой WordPress, магические 
числа не стоит использовать. Что говорят другие?

* Используя иконочные шрифты, не забывайте что для них, как и для обычных 
шрифтов, можно менять размер. Вы не можете «забронировать» для них пространство 
в пикселях, так как размер шрифта может измениться, а пиксельное значение нет. 

* Я хотел бы обновлять эту публикацию хорошими примерами сбоев при использовании 
магических чисел, так что если вы можете предложить такой пример, оставьте 
комментарий. 

* Если вы пытаетесь отцентрировать изображение и текст, [vertical-align][12] 
работает довольно неплохо. Однако я часто замечаю смещение на 1px и прописываю 
`postion: relative; top: 1px;` в таких случаях. Это магическое число? Не уверен. 

[1]: http://en.wikipedia.org/wiki/Magic_number_%28programming%29#Unnamed_numerical_constants
[2]: http://css-tricks.com/line-on-sides-headers/
[3]: http://codepen.io/chriscoyier/pen/KdIxo
[4]: http://css-tricks.com/almanac/properties/m/min-height/
[5]: http://csswizardry.com/2012/11/code-smells-in-css/
[6]: http://css-tricks.com/fighting-the-space-between-inline-block-elements/
[7]: http://css-tricks.com/fighting-the-space-between-inline-block-elements/
[8]: http://stackoverflow.com/questions/12015888/refactor-css-to-eliminate-magic-numbers
[9]: http://css-tricks.com/forums/discussion/22450/what-does-a-magic-number-in-css-really-mean
[10]: https://twitter.com/chriscoyier/status/299983970899197952
[11]: http://make.wordpress.org/core/handbook/coding-standards/css/#best-practices
[12]: http://css-tricks.com/what-is-vertical-align/

[Простой набор вкладок]: img/tabs-1.png?raw=true&amp;repo=magic-numbers-in-css
[Добавление вкладки с более длинным названием демонстрирует недостатки фиксированной ширины]: img/tabs-2.png?raw=true&amp;repo=magic-numbers-in-css
[Эффект от white-space: nowrap]: img/tabs-3.png?raw=true&amp;repo=magic-numbers-in-css
[Вид вкладок с заданной минимальной шириной]: img/tabs-4.png?raw=true&amp;repo=magic-numbers-in-css
[Вид вкладок без фиксированной ширины]: img/tabs-5.png?raw=true&amp;repo=magic-numbers-in-css
[Эффект от overflow: hidden; и text-overflow: ellipsis;]: img/tabs-6.png?raw=true&amp;repo=magic-numbers-in-css
[Сравнение результата применения приёма по добавлению линий по бокам текста примененного к разным шрифтам]: img/custom-font-magic-number-rus.png?raw=true&amp;repo=magic-numbers-in-css
[Блоки с разной высотой, плавающие по левому краю]: img/grid-mess.png?raw=true&amp;repo=magic-numbers-in-css
[Блоки с фиксированной высотой, плавающие по левому краю]: img/Screen-Shot-2013-04-22-at-8.19.55-AM.png?raw=true&amp;repo=magic-numbers-in-css
[Настройки шрифта в Chrome]: img/chrome-font-size-rus.png?raw=true&amp;repo=magic-numbers-in-css
[Текст, который не помещается в родительский блок с фиксированной высотой, перекрывает другие блоки]: img/Screen-Shot-2013-04-22-at-8.22.34-AM.png?raw=true&amp;repo=magic-numbers-in-css
[Приём по применению границы в -4px чтобы убрать отступы между элементами со свойством Inline-Block перестаёт работать когда меняется гарнитура или кегль]: img/inline-block-rus.png?raw=true&amp;repo=magic-numbers-in-css